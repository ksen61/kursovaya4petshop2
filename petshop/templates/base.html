{% load static %}
<!DOCTYPE html>
<html lang="ru" class="{% if request.user.is_authenticated and request.user.profile.theme %}dark-theme{% endif %}">
<html lang="ru">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="csrf-token" content="{{ csrf_token }}">
    <title>{% block title %}Yes of Кусь{% endblock %}</title>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />
    <link href="https://fonts.googleapis.com/css2?family=Rubik:wght@400;500;700;900&display=swap" rel="stylesheet" />
    <link rel="stylesheet" href="{% static 'style/style.css' %}" type="text/css" />
    <link rel="stylesheet" href="{% static 'style/base.css' %}" type="text/css">

    {% block extra_css %}{% endblock %}
    <style>
        .hotkeys-panel {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: rgba(44, 62, 34, 0.9);
            color: white;
            padding: 10px 15px;
            border-radius: 8px;
            font-size: 0.85rem;
            z-index: 9999;
        }
        .hotkeys-panel span {
            margin-right: 10px;
        }
    </style>
</head>
<body class="{% if user.is_authenticated and user.profile.theme %}dark-theme{% endif %}">

<header>
    {% include 'includes/_header.html' %}
</header>

<nav class="context-nav">
    {% block nav %}
    {% endblock %}
</nav>

<div class="additional-elements">
    {% block extra %}{% endblock %}
</div>

<main>
    {% block breadcrumbs %}
    {% endblock %}
    
    {% if form %}
    <div class="form-errors-block">
        {% if form.non_field_errors %}
            <div class="error-card global-error">
                <div class="error-icon">
                    <i class="fas fa-exclamation-circle"></i>
                </div>
                <div class="error-content">
                    <h3 class="error-title">Общая ошибка</h3>
                    {% for error in form.non_field_errors %}
                        <p class="error-message">{{ error }}</p>
                    {% endfor %}
                </div>
            </div>
        {% endif %}

        {% for field in form %}
            {% if field.errors %}
                <div class="error-card field-error">
                    <div class="error-icon">
                        <i class="fas fa-exclamation-triangle"></i>
                    </div>
                    <div class="error-content">
                        <h3 class="error-title">{{ field.label }}</h3>
                        {% for error in field.errors %}
                            <p class="error-message">{{ error }}</p>
                        {% endfor %}
                    </div>
                </div>
            {% endif %}
        {% endfor %}
    </div>
    {% endif %}

    {% block content %}{% endblock %}
</main>

<footer>
    {% include 'includes/_footer.html' %}
</footer>

<div class="hotkeys-panel">
    <span><b>G</b> – Главная</span>
    <span><b>R</b> – Каталог</span>
    <span><b>P</b> – Корзина</span>
    <span><b>J</b> – Оформление заказа</span>
    <span><b>U</b> – Профиль</span>
    <span><b>I</b> – История заказов</span>
    {% if user.is_staff %}
        <span><b>E</b> – Сводные таблицы</span>
        <span><b>D</b> – Диаграммы</span>
    {% endif %}
</div>

{% block extra_js %}
<script>
    document.addEventListener('DOMContentLoaded', function() {
        const accessibilityToggle = document.getElementById('accessibility-toggle');
        
        if (!accessibilityToggle) {
            console.error('Кнопка доступности не найдена!');
            return;
        }
        
        const isAccessibilityMode = localStorage.getItem('accessibilityMode') === 'true';
        
        if (isAccessibilityMode) {
            document.body.classList.add('accessibility-mode');
            updateAccessibilityButton(true);
            console.log('Режим доступности активирован');
        } else {
            updateAccessibilityButton(false);
        }
        
        function updateAccessibilityButton(isActive) {
            const icon = accessibilityToggle.querySelector('i');
            if (isActive) {
                icon.className = 'fas fa-eye-slash';
                accessibilityToggle.classList.add('accessibility-active');
                accessibilityToggle.title = 'Выключить режим для слабовидящих';
            } else {
                icon.className = 'fas fa-eye';
                accessibilityToggle.classList.remove('accessibility-active');
                accessibilityToggle.title = 'Включить режим для слабовидящих';
            }
        }
        
        let isProcessing = false;
        
        accessibilityToggle.addEventListener('click', function(event) {
            if (isProcessing) return;
            isProcessing = true;
            
            console.log('Кнопка нажата');
            document.body.classList.toggle('accessibility-mode');
            
            const isActive = document.body.classList.contains('accessibility-mode');
            
            if (isActive) {
                localStorage.setItem('accessibilityMode', 'true');
                console.log('Режим доступности включен');
            } else {
                localStorage.setItem('accessibilityMode', 'false');
                console.log('Режим доступности выключен');
            }
            
            updateAccessibilityButton(isActive);
            
            setTimeout(() => {
                isProcessing = false;
            }, 100);
        });
    });
document.addEventListener('keydown', function(event) {
    if (event.target.tagName === 'INPUT' || event.target.tagName === 'TEXTAREA') return;

    switch(event.key.toLowerCase()) {
        case 'p':
            window.location.href = "{% url 'cart' %}";
            break;
        case 'j':
            window.location.href = "{% url 'checkout' %}";
            break;
        case 'u':
            window.location.href = "{% url 'profile' %}";
            break;
        case 'i':
            window.location.href = "{% url 'order_list' %}";
            break;
        case 'g':
            window.location.href = "{% url 'index' %}";
            break;
        case 'r':
            window.location.href = "{% url 'product_list' %}";
            break;
        {% if user.is_staff %}
        case 'e':
            window.location.href = "{% url 'admin_summaries' %}";
            break;
        case 'd':
            window.location.href = "{% url 'sales_charts' %}";
            break;
        {% endif %}
    }
});
</script>
{% endblock %}

</body>
</html>